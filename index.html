<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>El Impostor - FÃºtbol</title>
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
  <style>
    body {
      font-family: Arial, sans-serif;
      background-color: #111;
      color: #eee;
      padding: 20px;
      text-align: center;
    }
    input, button {
      padding: 10px;
      margin: 5px;
      font-size: 16px;
    }
    .hidden {
      display: none;
    }
  </style>
</head>
<body>
  <h1>ðŸŽ¯ El Impostor - FÃºtbol</h1>
  <div id="login">
    <input id="nombre" placeholder="Tu nombre" />
    <button onclick="unirse()">Unirse</button>
  </div>

  <div id="lobby" class="hidden">
    <h2>Lobby</h2>
    <div id="jugadores"></div>
    <div id="liderControls" class="hidden">
      <button onclick="iniciarJuego()">Iniciar partida</button>
      <button onclick="reiniciarJuego()">Reiniciar</button>
    </div>
  </div>

  <div id="juego" class="hidden">
    <h2 id="jugadorSeleccionado"></h2>
    <p id="mensaje"></p>
    <div id="votacion"></div>
  </div>

  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyC75hIhVE6SYEuyGiR44Q2VqEzyGQeu-mI",
      authDomain: "impostorr-e087b.firebaseapp.com",
      databaseURL: "https://impostorr-e087b-default-rtdb.firebaseio.com",
      projectId: "impostorr-e087b",
      storageBucket: "impostorr-e087b.appspot.com",
      messagingSenderId: "94911572425",
      appId: "1:94911572425:web:b23187ef0213eb443c6018",
      measurementId: "G-VKYKF342DN"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    // Lista con jugadores mundialmente reconocidos
    const futbolistas = [
      "Lionel Messi", "Cristiano Ronaldo", "Neymar Jr.", "Kylian MbappÃ©", "Erling Haaland",
      "Robert Lewandowski", "Kevin De Bruyne", "Mohamed Salah", "Luka Modric", "Karim Benzema",
      "Sergio Ramos", "Manuel Neuer", "Harry Kane", "Virgil van Dijk", "Luis SuÃ¡rez",
      "Zlatan IbrahimoviÄ‡", "Paul Pogba", "Raheem Sterling", "Sadio ManÃ©", "Antoine Griezmann",
      "Luis Figo", "Ronaldinho", "Rivaldo", "Thierry Henry", "AndrÃ©s Iniesta",
      "Xavi HernÃ¡ndez", "Frank Lampard", "Steven Gerrard", "David Beckham", "Zinedine Zidane",
      "Paolo Maldini", "Roberto Carlos", "Cafu", "Johan Cruyff", "Diego Maradona",
      "PelÃ©", "George Best", "Bobby Charlton", "Gerd MÃ¼ller", "Ferenc PuskÃ¡s",
      "EusÃ©bio", "Michel Platini", "Marco van Basten", "JÃ¼rgen Klinsmann", "Franz Beckenbauer",
      "Drogba", "Kaka", "Luis Enrique", "Carlos Tevez", "RaÃºl GonzÃ¡lez",
      "David Villa", "Fernando Torres", "Iker Casillas", "Marcelo", "Thiago Silva",
      "Ãngel Di MarÃ­a", "Gareth Bale", "Paul Scholes", "Andriy Shevchenko", "Nemanja VidiÄ‡",
      "Diego ForlÃ¡n", "Robin van Persie", "Arjen Robben", "James RodrÃ­guez", "Juan Mata",
      "Mesut Ã–zil", "Karim Benzema", "Ã‰ric Cantona", "Claude MakÃ©lÃ©lÃ©", "Philipp Lahm",
      "Bastian Schweinsteiger", "Thomas MÃ¼ller", "Mats Hummels", "Mario GÃ¶tze", "Toni Kroos",
      "Marc-AndrÃ© ter Stegen", "Alisson Becker", "Jan Oblak", "Ederson Moraes", "Thibaut Courtois",
      "Kalidou Koulibaly", "Trent Alexander-Arnold", "Jordan Henderson", "N'Golo KantÃ©", "Raheem Sterling",
      "Leroy SanÃ©", "Jadon Sancho", "Phil Foden", "Mason Mount", "Bukayo Saka",
      "Jude Bellingham", "Erling Haaland", "VinÃ­cius Jr.", "Rodrygo", "Pedri",
      "Frenkie de Jong", "Gavi", "JoÃ£o FÃ©lix", "Bernardo Silva", "RÃºben Dias",
      "RaphaÃ«l Varane", "Paul Pogba", "Edinson Cavani", "Ãlvaro Morata", "Kylian MbappÃ©",
      "Marcelo", "Coutinho", "Sergio AgÃ¼ero", "Diego GodÃ­n", "Roberto Firmino",
      "Luis Alberto", "JoÃ£o Cancelo", "Alexis SÃ¡nchez", "Timo Werner", "Thomas Lemar",
      "Timo Werner", "Hugo Lloris", "David Alaba", "Gareth Bale", "Christian Eriksen",
      "Ivan RakitiÄ‡", "Neymar", "Manuel Neuer", "David Silva", "Dani Alves",
      "Gianluigi Buffon", "Wesley Sneijder", "Claudio Marchisio", "Marco Reus", "Ivan PeriÅ¡iÄ‡",
      "Gonzalo HiguaÃ­n", "James Milner", "Ashley Cole", "Cesc FÃ bregas", "Eden Hazard",
      "Luka ModriÄ‡", "Mario MandÅ¾ukiÄ‡", "Dani Carvajal", "Ãngel Correa", "Lucas Moura",
      "Lucas Digne", "Miralem PjaniÄ‡", "Matthijs de Ligt", "Kalvin Phillips", "Rodri",
      "Bruno Fernandes", "Christian Pulisic", "Gianluigi Donnarumma", "Eduardo Camavinga",
      "Federico Valverde", "Achraf Hakimi", "Philippe Coutinho", "Mousa DembÃ©lÃ©", "Yaya TourÃ©",
      "Karim Benzema", "Thiago AlcÃ¢ntara", "Marquinhos", "Sergio Busquets", "Marc-AndrÃ© ter Stegen",
      "Gerard PiquÃ©", "Lucas HernÃ¡ndez", "Jordi Alba", "RaphaÃ«l Varane", "CÃ©sar Azpilicueta",
      "Jordi Alba", "Sergio Busquets", "Juan Cuadrado", "Javier Mascherano", "Thiago Silva"
    ];

    let nombreUsuario = "";
    let esLider = false;

    function unirse() {
      nombreUsuario = document.getElementById("nombre").value.trim();
      if (!nombreUsuario) return alert("IngresÃ¡ tu nombre");

      const ref = db.ref("jugadores");
      ref.once("value", snap => {
        const jugadores = snap.val() || {};
        if (Object.keys(jugadores).length === 0) esLider = true;

        db.ref("jugadores/" + nombreUsuario).set({ nombre: nombreUsuario });
        document.getElementById("login").classList.add("hidden");
        document.getElementById("lobby").classList.remove("hidden");
        if (esLider) document.getElementById("liderControls").classList.remove("hidden");
      });

      db.ref("jugadores").on("value", snap => {
        const jugadores = snap.val() || {};
        document.getElementById("jugadores").innerHTML =
          Object.keys(jugadores).map(j => `<div>${j}</div>`).join("");
      });

      // Eliminar jugador cuando cierra pestaÃ±a
      db.ref("jugadores/" + nombreUsuario).onDisconnect().remove();

      // Escuchar partida asignada
      db.ref("jugadores/" + nombreUsuario + "/partida").on("value", snap => {
        const jugador = snap.val();
        if (!jugador) return;
        document.getElementById("lobby").classList.add("hidden");
        document.getElementById("juego").classList.remove("hidden");
        if (jugador === "IMPOSTOR") {
          document.getElementById("jugadorSeleccionado").innerText = "No sabÃ©s quiÃ©n es el jugador. Sos el impostor ðŸ˜ˆ";
        } else {
          document.getElementById("jugadorSeleccionado").innerText = `El jugador es: ${jugador}`;
        }
        mostrarVotacion();
      });
    }

    function iniciarJuego() {
      db.ref("jugadores").once("value", snap => {
        const jugadores = Object.keys(snap.val() || {});
        const futbolista = futbolistas[Math.floor(Math.random() * futbolistas.length)];
        const impostor = jugadores[Math.floor(Math.random() * jugadores.length)];

        // Limpiar votos anteriores
        db.ref("votos").remove();

        jugadores.forEach(j => {
          db.ref("jugadores/" + j + "/partida").set(j === impostor ? "IMPOSTOR" : futbolista);
        });

        db.ref("partida/jugador").set(futbolista);
      });
    }

    function reiniciarJuego() {
      db.ref().set(null);
      location.reload();
    }

    function mostrarVotacion() {
      db.ref("jugadores").once("value", snap => {
        const jugadores = Object.keys(snap.val() || {});
        db.ref("votos/" + nombreUsuario).once("value", votoSnap => {
          if (votoSnap.exists()) {
            // Ya votÃ³, mostrar mensaje
            document.getElementById("votacion").innerHTML = `<p>Ya votaste. Gracias.</p>`;
          } else {
            // Puede votar
            document.getElementById("votacion").innerHTML = jugadores.map(j =>
              `<button onclick="votar('${j}')" style="margin:3px;">Votar a ${j}</button>`
            ).join("<br>");
          }
        });
      });
    }

    function votar(nombre) {
      // Solo votar si no votÃ³ antes
      db.ref("votos/" + nombreUsuario).once("value", votoSnap => {
        if (votoSnap.exists()) {
          alert("Ya votaste");
          mostrarVotacion();
          return;
        }
        db.ref("votos/" + nombreUsuario).set(nombre);
      });
    }

    db.ref("votos").on("value", snap => {
      const votos = snap.val() || {};
      // Contar votos por jugador
      const cuenta = {};
      Object.values(votos).forEach(voto => {
        cuenta[voto] = (cuenta[voto] || 0) + 1;
      });
      const resultado = Object.entries(cuenta).map(([jugador, cant]) =>
        `${jugador}: ${cant} voto${cant > 1 ? "s" : ""}`
      ).join("<br>");
      document.getElementById("mensaje").innerHTML = resultado;
    });
  </script>
</body>
</html>
