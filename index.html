<!DOCTYPE html>
<html lang="es">
<<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>El Impostor: Fútbol</title>
  <style>
    body { font-family: Arial, sans-serif; text-align: center; padding: 30px; }
    #players { margin-top: 20px; }
    .hidden { display: none; }
    #startBtn { margin-top: 20px; padding: 10px 20px; font-size: 18px; }
    .player-name { margin: 5px 0; }
  </style>
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
</head>
<body>
  <h1>El Impostor ⚽</h1>
  <p>Compartí este link con tus amigos para que se unan.</p>
  <div id="lobby">
    <input id="nameInput" placeholder="Tu nombre" />
    <button onclick="joinLobby()">Unirse</button>
  </div>
  <div id="game" class="hidden">
    <h2>Jugadores en la sala:</h2>
    <div id="players"></div>
    <button id="startBtn" class="hidden" onclick="startGame()">Iniciar juego</button>
    <div id="result" class="hidden"></div>
  </div>

  <script>
    // CONFIGURA TU FIREBASE ABAJO
    const firebaseConfig = {
    apiKey: "AIzaSyC75hIhVE6SYEuyGiR44Q2VqEzyGQeu-mI",
    authDomain: "impostorr-e087b.firebaseapp.com",
    databaseURL: "https://impostorr-e087b-default-rtdb.firebaseio.com",
    projectId: "impostorr-e087b",
    storageBucket: "impostorr-e087b.firebasestorage.app",
    messagingSenderId: "94911572425",
    appId: "1:94911572425:web:b23187ef0213eb443c6018",
    measurementId: "G-VKYKF342DN"
  };


    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    const lobbyId = "sala-principal"; // Puede ser dinámico si querés varias salas
    let playerId = Math.random().toString(36).substring(2, 9);
    let isLeader = false;
    let name = "";
    let isImpostor = false;
    let jugadorSeleccionado = "";
    const futbolistas = ["Ángel Correa", "Paulo Dybala", "Rodrigo De Paul", "Lautaro Martínez", "Giovani Lo Celso"];

    function joinLobby() {
      name = document.getElementById('nameInput').value;
      if (!name) return alert("Escribí tu nombre");

      const playerRef = db.ref(`lobbies/${lobbyId}/players/${playerId}`);
      playerRef.set({ name });

      db.ref(`lobbies/${lobbyId}/players`).once('value', snapshot => {
        if (snapshot.numChildren() === 1) {
          isLeader = true;
          document.getElementById('startBtn').classList.remove('hidden');
        }
      });

      document.getElementById('lobby').classList.add('hidden');
      document.getElementById('game').classList.remove('hidden');

      db.ref(`lobbies/${lobbyId}/players`).on('value', snapshot => {
        const players = snapshot.val() || {};
        const container = document.getElementById('players');
        container.innerHTML = '';
        Object.values(players).forEach(p => {
          const div = document.createElement('div');
          div.className = 'player-name';
          div.innerText = p.name;
          container.appendChild(div);
        });
      });

      db.ref(`lobbies/${lobbyId}/game`).on('value', snapshot => {
        const game = snapshot.val();
        if (!game) return;
        jugadorSeleccionado = game.jugador;
        const impostorId = game.impostor;
        isImpostor = impostorId === playerId;
        document.getElementById('startBtn').classList.add('hidden');
        document.getElementById('result').classList.remove('hidden');
        document.getElementById('result').innerText = isImpostor
          ? "Sos el IMPOSTOR. Descubrí al jugador oculto."
          : `El jugador es: ${jugadorSeleccionado}`;
      });
    }

    function startGame() {
      db.ref(`lobbies/${lobbyId}/players`).once('value', snapshot => {
        const players = snapshot.val();
        const keys = Object.keys(players);
        const impostorId = keys[Math.floor(Math.random() * keys.length)];
        const jugador = futbolistas[Math.floor(Math.random() * futbolistas.length)];

        db.ref(`lobbies/${lobbyId}/game`).set({ jugador, impostor: impostorId });
      });
    }
  </script>
</body>
</html>
