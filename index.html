<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>El Impostor - FÃºtbol</title>
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
  <style>
    body {
      font-family: Arial, sans-serif;
      background-color: #111;
      color: #eee;
      padding: 20px;
      text-align: center;
    }
    input, button {
      padding: 10px;
      margin: 5px;
      font-size: 16px;
    }
    .hidden {
      display: none;
    }
  </style>
</head>
<body>
  <h1>ðŸŽ¯ El Impostor - FÃºtbol</h1>
  <div id="login">
    <input id="nombre" placeholder="Tu nombre" />
    <button onclick="unirse()">Unirse</button>
  </div>

  <div id="lobby" class="hidden">
    <h2>Lobby</h2>
    <div id="jugadores"></div>
    <div id="liderControls" class="hidden">
      <button onclick="iniciarJuego()">Iniciar partida</button>
      <button onclick="reiniciarJuego()">Reiniciar</button>
    </div>
  </div>

  <div id="juego" class="hidden">
    <h2 id="jugadorSeleccionado"></h2>
    <p id="mensaje"></p>
    <div id="votacion"></div>
  </div>

  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyC75hIhVE6SYEuyGiR44Q2VqEzyGQeu-mI",
      authDomain: "impostorr-e087b.firebaseapp.com",
      databaseURL: "https://impostorr-e087b-default-rtdb.firebaseio.com",
      projectId: "impostorr-e087b",
      storageBucket: "impostorr-e087b.appspot.com",
      messagingSenderId: "94911572425",
      appId: "1:94911572425:web:b23187ef0213eb443c6018",
      measurementId: "G-VKYKF342DN"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    const futbolistas = [
      "Lionel Messi", "Cristiano Ronaldo", "Kylian MbappÃ©", "Erling Haaland", "Neymar Jr.",
      "Luka Modric", "Toni Kroos", "Karim Benzema", "Robert Lewandowski", "Harry Kane",
      "Mohamed Salah", "Sadio ManÃ©", "Kevin De Bruyne", "Phil Foden", "Ilkay GÃ¼ndogan",
      "Virgil van Dijk", "Alisson Becker", "Ederson Moraes", "Thibaut Courtois", "Jan Oblak",
      "Sergio Ramos", "Gerard PiquÃ©", "Jude Bellingham", "Vinicius Jr.", "Rodrygo Goes",
      "Antoine Griezmann", "Ousmane DembÃ©lÃ©", "Frenkie de Jong", "Pedri", "Gavi",
      "Achraf Hakimi", "Sofyan Amrabat", "Yassine Bounou", "JoÃ£o FÃ©lix", "Diogo Jota",
      "Bruno Fernandes", "RÃºben Dias", "Bernardo Silva", "Rafael LeÃ£o", "Christian Eriksen",
      "Romelu Lukaku", "Lautaro MartÃ­nez", "Paulo Dybala", "Ãngel Di MarÃ­a", "Rodrigo De Paul",
      "NicolÃ¡s Otamendi", "Emiliano MartÃ­nez", "Enzo FernÃ¡ndez", "Alexis Mac Allister", "JuliÃ¡n Ãlvarez",
      "Giovani Lo Celso", "Leandro Paredes", "Nahuel Molina", "Lisandro MartÃ­nez", "Cristian Romero",
      "Federico Valverde", "Darwin NÃºÃ±ez", "Luis SuÃ¡rez", "Edinson Cavani", "Diego GodÃ­n",
      "James RodrÃ­guez", "Juan Cuadrado", "DuvÃ¡n Zapata", "Luis DÃ­az", "Wilmar Barrios",
      "Alphonso Davies", "Jonathan David", "Christian Pulisic", "Weston McKennie", "Tyler Adams",
      "Gio Reyna", "SergiÃ±o Dest", "AndrÃ© Onana", "Victor Osimhen", "Wilfred Ndidi",
      "Thomas Partey", "Mohammed Kudus", "AndrÃ© Ayew", "Takumi Minamino", "Kaoru Mitoma",
      "Son Heung-min", "Hwang Hee-chan", "Mehdi Taremi", "Sardar Azmoun", "Hirving Lozano",
      "RaÃºl JimÃ©nez", "AndrÃ©s Guardado", "Guillermo Ochoa", "Keylor Navas", "Bryan Ruiz",
      "Joel Campbell", "Clint Dempsey", "Tim Howard", "Diego ForlÃ¡n", "Carlos Valderrama",
      "Ronaldinho", "PelÃ©", "Diego Maradona", "Zinedine Zidane", "Francesco Totti",
      "Alessandro Del Piero", "Andrea Pirlo", "Gianluigi Buffon", "Paolo Maldini", "Fabio Cannavaro",
      "Cafu", "Roberto Carlos", "Rivaldo", "Ronaldo NazÃ¡rio", "Zico",
      "George Weah", "Samuel Eto'o", "Didier Drogba", "Emmanuel Adebayor", "Yaya TourÃ©",
      "Jay-Jay Okocha", "Roger Milla", "Patrick Vieira", "Thierry Henry", "David Beckham",
      "Wayne Rooney", "Frank Lampard", "Steven Gerrard", "Paul Scholes", "Rio Ferdinand",
      "John Terry", "Ashley Cole", "Petr ÄŒech", "Nemanja VidiÄ‡", "Dimitar Berbatov",
      "Robin van Persie", "Arjen Robben", "Wesley Sneijder", "Clarence Seedorf", "Edgar Davids",
      "Ruud van Nistelrooy", "Marco van Basten", "Dennis Bergkamp", "Xavi", "Iniesta",
      "David Villa", "Fernando Torres", "Iker Casillas", "Sergio Busquets", "Gerard Moreno",
      "Ãlvaro Morata", "Koke", "Marco Asensio", "JesÃºs Navas", "Pau Torres",
      "Ciro Immobile", "Lorenzo Insigne", "Federico Chiesa", "Leonardo Bonucci", "Giorgio Chiellini",
      "Gianluigi Donnarumma", "Manuel Neuer", "Joshua Kimmich", "Leon Goretzka", "Kai Havertz",
      "Timo Werner", "Thomas MÃ¼ller", "Mats Hummels", "Antonio RÃ¼diger", "Marc-AndrÃ© ter Stegen",
      "Mesut Ã–zil", "Mario GÃ¶tze", "Miroslav Klose", "Bastian Schweinsteiger", "Philipp Lahm",
      "Andriy Shevchenko", "Henrikh Mkhitaryan", "Luka JoviÄ‡", "Ivan PeriÅ¡iÄ‡", "Mario MandÅ¾ukiÄ‡",
      "Dejan Lovren", "Domagoj Vida", "Danijel SubaÅ¡iÄ‡", "Nikola VlaÅ¡iÄ‡", "Josko Gvardiol"
    ];

    let nombreUsuario = "";
    let esLider = false;

    function unirse() {
      nombreUsuario = document.getElementById("nombre").value;
      if (!nombreUsuario) return alert("IngresÃ¡ tu nombre");

      const ref = db.ref("jugadores");
      ref.once("value", snap => {
        const jugadores = snap.val() || {};
        if (Object.keys(jugadores).length === 0) esLider = true;
        db.ref("jugadores/" + nombreUsuario).set({ nombre: nombreUsuario });
        document.getElementById("login").classList.add("hidden");
        document.getElementById("lobby").classList.remove("hidden");
        if (esLider) document.getElementById("liderControls").classList.remove("hidden");
      });

      db.ref("jugadores").on("value", snap => {
        const jugadores = snap.val() || {};
        document.getElementById("jugadores").innerHTML =
          Object.keys(jugadores).map(j => `<div>${j}</div>`).join("");
      });

      db.ref("jugadores/" + nombreUsuario).onDisconnect().remove();

      db.ref("jugadores/" + nombreUsuario + "/partida").on("value", snap => {
        const jugador = snap.val();
        if (!jugador) return;
        document.getElementById("lobby").classList.add("hidden");
        document.getElementById("juego").classList.remove("hidden");
        if (jugador === "IMPOSTOR") {
          document.getElementById("jugadorSeleccionado").innerText = "No sabÃ©s quiÃ©n es el jugador. Sos el impostor ðŸ˜ˆ";
        } else {
          document.getElementById("jugadorSeleccionado").innerText = `El jugador es: ${jugador}`;
        }
        mostrarVotacion();
      });
    }

    function iniciarJuego() {
      db.ref("jugadores").once("value", snap => {
        const jugadores = Object.keys(snap.val() || {});
        const futbolista = futbolistas[Math.floor(Math.random() * futbolistas.length)];
        const impostor = jugadores[Math.floor(Math.random() * jugadores.length)];
        jugadores.forEach(j => {
          db.ref("jugadores/" + j + "/partida").set(j === impostor ? "IMPOSTOR" : futbolista);
        });
        db.ref("partida/jugador").set(futbolista);
      });
    }

    function reiniciarJuego() {
      db.ref().set(null);
      location.reload();
    }

    function mostrarVotacion() {
      db.ref("jugadores").once("value", snap => {
        const jugadores = Object.keys(snap.val() || {});
        document.getElementById("votacion").innerHTML = jugadores.map(j =>
          `<button onclick="votar('${j}')">Votar a ${j}</button>`).join("<br>");
      });
    }

    function votar(nombre) {
      db.ref("votos/" + nombre).transaction(v => (v || 0) + 1);
    }

    db.ref("votos").on("value", snap => {
      const votos = snap.val() || {};
      const resultado = Object.entries(votos).map(([jugador, cant]) => `${jugador}: ${cant} votos`).join("<br>");
      document.getElementById("mensaje").innerHTML = resultado;
    });
  </script>
</body>
</html>
